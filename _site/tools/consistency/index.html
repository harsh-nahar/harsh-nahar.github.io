<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="https://cdn.jsdelivr.net/gh/harsh-nahar/assets@main/blog-images/harsh-home.jpg">
  <link rel="apple-touch-icon" href="https://cdn.jsdelivr.net/gh/harsh-nahar/assets@main/blog-images/harsh-home.jpg">
  
  <!-- Social Preview Meta Tags -->
  <title>consistency - harsh nahar</title>
  <meta name="description" content="Welcome to my little corner of the web.">
  
  <!-- Open Graph / Facebook / iMessage -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="http://localhost:4000/tools/consistency/">
  <meta property="og:title" content="consistency">
  <meta property="og:description" content="track your habits. visualize your life.">
  
  
    <meta property="og:image" content="https://cdn.jsdelivr.net/gh/harsh-nahar/assets@main/blog-assets/dark_consistencygrid.webp">
  

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="http://localhost:4000/tools/consistency/">
  <meta property="twitter:title" content="consistency">
  <meta property="twitter:description" content="track your habits. visualize your life.">
  
    <meta property="twitter:image" content="https://cdn.jsdelivr.net/gh/harsh-nahar/assets@main/blog-assets/dark_consistencygrid.webp">
  

  <!-- Tailwind CSS & Typography Plugin -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.tailwindcss.com?plugins=typography"></script>

  <!-- Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">

  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            dark: { bg: '#000000', card: '#1c1c1e', text: '#f5f5f7', muted: '#86868b', border: '#333333' }
          },
          fontFamily: {
            sans: ['-apple-system', 'BlinkMacSystemFont', '"SF Pro Text"', '"Inter"', 'sans-serif'],
            mono: ['ui-monospace', 'SFMono-Regular', '"JetBrains Mono"', 'monospace'],
          },
          typography: (theme) => ({
            DEFAULT: { css: { '--tw-prose-body': '#1d1d1f', '--tw-prose-headings': '#1d1d1f', '--tw-prose-links': '#0071e3', maxWidth: 'none' } },
            invert: { css: { '--tw-prose-body': '#f5f5f7', '--tw-prose-headings': '#f5f5f7', '--tw-prose-links': '#2997ff' } },
          }),
        }
      }
    }
  </script>
  <style>
    body { transition: background-color 0.3s ease, color 0.3s ease; }
    .glass-nav { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border-bottom: 1px solid rgba(0,0,0,0.05); }
    .dark .glass-nav { background: rgba(0, 0, 0, 0.7); border-bottom: 1px solid rgba(255,255,255,0.1); }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body class="bg-white text-[#1d1d1f] dark:bg-dark-bg dark:text-dark-text min-h-screen flex flex-col antialiased selection:bg-blue-100 dark:selection:bg-blue-900">

  <!-- NAVIGATION: Hidden if page.layout == 'home' -->
  
  <nav class="fixed top-0 w-full z-50 glass-nav">
    <div class="max-w-3xl mx-auto px-6 h-16 flex items-center justify-between">
      <a href="/" class="text-lg font-semibold tracking-tight hover:opacity-70 transition-opacity whitespace-nowrap">harsh nahar</a>
      <div class="flex items-center gap-6">
        <div class="hidden sm:flex gap-6 text-sm font-medium text-[#86868b] dark:text-gray-400">
          <a href="/blog/" class="hover:text-black dark:hover:text-white transition-colors">blog</a>
          <a href="/gallery/" class="hover:text-black dark:hover:text-white transition-colors">photography</a>
          <a href="/reading/" class="hover:text-black dark:hover:text-white transition-colors">books</a>
          <a href="/tools/" class="hover:text-black dark:hover:text-white transition-colors">fun-stuff</a>
        </div>
        <button onclick="toggleTheme()" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-white/10 transition-colors text-gray-500 dark:text-gray-400">
          <i data-lucide="moon" class="w-5 h-5 hidden dark:block"></i>
          <i data-lucide="sun" class="w-5 h-5 block dark:hidden"></i>
        </button>
      </div>
    </div>
    <!-- Mobile Nav -->
    <div class="sm:hidden border-t border-gray-100 dark:border-white/5 py-2 overflow-x-auto no-scrollbar px-6 flex gap-6 text-sm font-medium text-[#86868b] dark:text-gray-400">
       <a href="/blog/" class="hover:text-black dark:hover:text-white whitespace-nowrap">blog</a>
       <a href="/gallery/" class="hover:text-black dark:hover:text-white whitespace-nowrap">photography</a>
       <a href="/reading/" class="hover:text-black dark:hover:text-white transition-colors">books</a>
       <a href="/tools/" class="hover:text-black dark:hover:text-white whitespace-nowrap">fun-stuff</a>
    </div>
  </nav>
  

  <!-- MAIN CONTENT: Increased width to max-w-3xl -->
  <main class="flex-grow w-full max-w-3xl mx-auto px-6 py-12 mt-24">
    <!-- PWA Tags -->
<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#000000" media="(prefers-color-scheme: dark)">

<style>
    /* --- PWA / APP MODE OVERRIDES --- */
    /* This only runs when added to Home Screen */
    @media all and (display-mode: standalone) {
        /* Hide the main website navigation bar */
        nav { display: none !important; }
        
        /* Hide the main website footer */
        footer { display: none !important; }
        
        /* Reset top margin since Nav is gone */
        main { margin-top: 0 !important; padding-top: 20px !important; }
        
        /* Ensure full height */
        body { min-height: 100vh; }
    }

    /* --- LAYOUT --- */
    .grid-area {
        display: flex;
        align-items: flex-end;
        gap: 8px;
        margin-bottom: 20px;
    }

    /* --- DAY LABELS --- */
    .day-labels {
        display: grid;
        grid-template-rows: repeat(7, 13px);
        gap: 3px;
        text-align: right;
        padding-right: 4px;
    }
    .day-label {
        font-size: 0.6rem;
        color: #9ca3af;
        height: 13px;
        line-height: 13px;
        opacity: 0; 
    }
    .day-label.visible { opacity: 1; }

    /* --- HABIT GRID --- */
    .grid-scroller {
        overflow-x: auto;
        padding-bottom: 10px;
        scrollbar-width: none;
        -ms-overflow-style: none;
        flex: 1;
        mask-image: linear-gradient(to right, black 90%, transparent 100%);
        -webkit-mask-image: linear-gradient(to right, black 90%, transparent 100%);
    }
    .grid-scroller::-webkit-scrollbar { display: none; }

    .months-row {
        display: flex;
        height: 16px;
        margin-bottom: 4px;
        position: relative;
        white-space: nowrap;
        pointer-events: none;
    }
    .month-label {
        position: absolute;
        font-size: 0.6rem;
        text-transform: uppercase;
        color: #9ca3af;
        font-weight: 600;
    }

    .contribution-grid {
        display: grid;
        grid-template-rows: repeat(7, 13px);
        grid-auto-flow: column;
        gap: 3px;
        width: max-content;
    }

    .day-cell {
        width: 13px;
        height: 13px;
        border-radius: 3px;
        background-color: #e5e7eb;
        cursor: pointer;
        transition: all 0.1s ease;
    }
    .dark .day-cell { background-color: #27272a; }
    .day-cell:hover { transform: scale(1.4); z-index: 10; border: 1px solid #9ca3af; }
    
    /* Active Habits */
    .day-cell.active { background-color: #1d1d1f; }
    .dark .day-cell.active { background-color: #fff; box-shadow: 0 0 4px rgba(255,255,255,0.3); }
    
    .day-cell.today { border: 2px solid #3b82f6; animation: pulse 2s infinite; }

    @keyframes pulse {
        0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4); }
        70% { box-shadow: 0 0 0 4px rgba(59, 130, 246, 0); }
        100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
    }

    /* --- LIFE GRID (YEARS) --- */
    .life-grid-years {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(30px, 1fr));
        gap: 6px;
        margin-top: 20px;
    }
    
    .year-box {
        aspect-ratio: 1;
        background-color: #e5e7eb; /* Future (Empty) */
        border-radius: 4px;
        position: relative;
        overflow: hidden;
    }
    .dark .year-box { background-color: #27272a; }

    /* Lived Years (Solid - Softer Gray) */
    .year-box.spent { 
        background-color: #9ca3af; /* Gray-400 */
    }
    .dark .year-box.spent { 
        background-color: #4b5563; /* Gray-600 */
    }

    /* Current Year (Solid Blue) */
    .year-box.current {
        background-color: #3b82f6;
        box-shadow: 0 0 8px rgba(59, 130, 246, 0.4);
    }

    /* --- UI ELEMENTS --- */
    .clean-input {
        background: transparent; font-size: 1.5rem; font-weight: 700; color: #1d1d1f;
        border: none; border-bottom: 2px solid transparent; width: 100%; padding: 0;
    }
    .dark .clean-input { color: #fff; }
    .clean-input:focus { outline: none; border-bottom-color: #3b82f6; }

    /* Big Selectors */
    .big-select {
        background: transparent;
        font-size: 1.1rem;
        font-weight: 500;
        color: #1d1d1f;
        border: none;
        border-bottom: 1px solid #e5e7eb;
        padding: 4px 24px 4px 0;
        margin-right: 8px;
        cursor: pointer;
        appearance: none;
        background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%239CA3AF%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
        background-repeat: no-repeat;
        background-position: right 0 top 50%;
        background-size: 10px auto;
    }
    .dark .big-select { color: #fff; border-color: #333; }

    .mode-toggle { display: flex; gap: 16px; border-bottom: 1px solid #e5e7eb; margin-bottom: 24px; }
    .dark .mode-toggle { border-color: #27272a; }
    .mode-btn { padding-bottom: 8px; font-size: 0.85rem; font-weight: 500; color: #9ca3af; cursor: pointer; border-bottom: 2px solid transparent; }
    .mode-btn.active { color: #1d1d1f; border-bottom-color: #1d1d1f; }
    .dark .mode-btn.active { color: #fff; border-bottom-color: #fff; }

    .soft-btn {
        padding: 10px 24px; border-radius: 99px; font-weight: 600; font-size: 0.9rem;
        border: 1px solid #e5e7eb; background: transparent; color: #6b7280;
        transition: all 0.2s; display: flex; align-items: center; gap: 8px;
    }
    .dark .soft-btn { border-color: #27272a; color: #9ca3af; }
    .soft-btn:hover { border-color: #3b82f6; color: #3b82f6; background: rgba(59, 130, 246, 0.05); }
    
    .soft-btn.active {
        background: #1d1d1f; color: white; border-color: #1d1d1f;
    }
    .dark .soft-btn.active {
        background: #fff; color: black; border-color: #fff;
    }

    .stat-num { font-family: 'JetBrains Mono', monospace; font-size: 1.25rem; font-weight: 700; }

    /* Modal */
    .modal-backdrop {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.5); backdrop-filter: blur(4px);
        z-index: 50; display: none; align-items: center; justify-content: center;
    }
    .modal-content {
        background: white; width: 90%; max-width: 400px;
        border-radius: 16px; padding: 24px;
    }
    .dark .modal-content { background: #1c1c1e; color: white; border: 1px solid #333; }
</style>

<div class="fade-in max-w-5xl mx-auto mb-20">
    
    <!-- Header -->
    <div class="flex justify-between items-start mb-8">
        <div class="w-full max-w-md">
            <p class="text-xs text-gray-400 mb-1 lowercase">consistency grid for</p>
            <input type="text" id="userName" class="clean-input lowercase" placeholder="[tap to add name]" autocomplete="off">
        </div>
        <button onclick="toggleInstallModal()" class="p-2 text-gray-400 hover:text-blue-500 transition-colors" title="Install App">
            <i data-lucide="download" class="w-5 h-5"></i>
        </button>
    </div>

    <!-- Mode Switcher -->
    <div class="mode-toggle">
        <button class="mode-btn active" id="modeHabit" onclick="switchMode('habit')">habits</button>
        <button class="mode-btn" id="modeLife" onclick="switchMode('life')">life</button>
    </div>

    <!-- === MODE: HABIT === -->
    <div id="viewHabit">
        <!-- Controls -->
        <div class="flex justify-between items-center mb-6">
            <div class="flex items-center gap-2">
                <select id="habitSelect" class="bg-transparent font-bold text-lg focus:outline-none cursor-pointer text-[#1d1d1f] dark:text-white">
                    <!-- Populated by JS -->
                </select>
                <button onclick="addNewHabit()" class="p-1 text-gray-400 hover:text-blue-500"><i data-lucide="plus-circle" class="w-4 h-4"></i></button>
                <button onclick="renameHabit()" class="p-1 text-gray-400 hover:text-blue-500"><i data-lucide="edit-2" class="w-4 h-4"></i></button>
                <button onclick="deleteHabit()" class="p-1 text-gray-400 hover:text-red-500"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
            </div>
            
            <div class="text-xs text-gray-400 font-mono" id="dateDisplay">select a cell</div>
        </div>

        <!-- Grid Area -->
        <div class="grid-area">
            <!-- Sticky Day Labels -->
            <div class="day-labels">
                <div class="day-label"></div>
                <div class="day-label visible">Mon</div>
                <div class="day-label"></div>
                <div class="day-label visible">Wed</div>
                <div class="day-label"></div>
                <div class="day-label visible">Fri</div>
                <div class="day-label"></div>
            </div>

            <!-- Scroller -->
            <div class="grid-scroller" id="habitGridContainer">
                <div class="months-row" id="monthRow"></div>
                <div id="habitGrid" class="contribution-grid"></div>
            </div>
        </div>

        <!-- Action Bar -->
        <div class="flex flex-col sm:flex-row items-center justify-between gap-6 mt-4">
            <div class="flex gap-8 text-center sm:text-left w-full sm:w-auto justify-between sm:justify-start">
                <div>
                    <div id="currentStreak" class="stat-num text-blue-500">0</div>
                    <p class="text-[10px] uppercase tracking-wider text-gray-400">Streak</p>
                </div>
                <div>
                    <div id="totalDays" class="stat-num text-[#1d1d1f] dark:text-white">0</div>
                    <p class="text-[10px] uppercase tracking-wider text-gray-400">Total</p>
                </div>
                <div>
                    <div id="consistency" class="stat-num text-gray-500">0%</div>
                    <p class="text-[10px] uppercase tracking-wider text-gray-400">Yearly</p>
                </div>
            </div>

            <button id="markTodayBtn" onclick="toggleToday()" class="soft-btn w-full sm:w-auto justify-center">
                <i data-lucide="check" class="w-4 h-4"></i> Mark Today
            </button>
        </div>
    </div>

    <!-- === MODE: LIFE === -->
    <div id="viewLife" class="hidden">
        <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-6 gap-4">
            <div class="flex items-center">
                <p class="text-sm text-gray-500 mr-3">Born:</p>
                <select id="birthMonth" class="big-select" onchange="renderLifeGrid()">
                    <option value="0">Jan</option><option value="1">Feb</option><option value="2">Mar</option><option value="3">Apr</option><option value="4">May</option><option value="5">Jun</option><option value="6">Jul</option><option value="7">Aug</option><option value="8">Sep</option><option value="9">Oct</option><option value="10">Nov</option><option value="11">Dec</option>
                </select>
                <select id="birthYear" class="big-select" onchange="renderLifeGrid()"></select>
            </div>
            <div class="text-right">
                <div id="lifePercent" class="stat-num text-[#1d1d1f] dark:text-white">0%</div>
                <p class="text-[10px] uppercase tracking-wider text-gray-400">Lived (75 Years)</p>
            </div>
        </div>

        <!-- Year Grid -->
        <div id="lifeGrid" class="life-grid-years"></div>
        
        <!-- Quotes (Moved Below) -->
        <div class="mt-12 p-6 bg-gray-50 dark:bg-white/5 rounded-xl text-center border border-gray-100 dark:border-white/5 transition-all duration-500">
            <p class="text-lg font-serif italic text-[#1d1d1f] dark:text-white animate-in fade-in slide-in-from-bottom-2" id="lifeQuote">"</p>
            <p class="text-xs text-gray-400 mt-2 uppercase tracking-widest" id="lifeAuthor"></p>
        </div>
    </div>

    <!-- Footer -->
    <div class="border-t border-gray-100 dark:border-white/10 pt-8 mt-12 flex flex-col sm:flex-row justify-between items-center gap-4 text-xs text-gray-400">
        <div class="flex gap-4">
            <button onclick="exportData()" class="hover:text-black dark:hover:text-white underline">backup json</button>
            <label class="hover:text-black dark:hover:text-white underline cursor-pointer">
                restore json (install app)
                <input type="file" id="importFile" class="hidden" accept=".json" onchange="importData(this)">
            </label>
        </div>
        
        <p>
            inspired by: <a href="https://github.com" target="_blank" class="hover:text-black dark:hover:text-white">github</a> & 
            <a href="https://www.gridmylife.com/" target="_blank" class="hover:text-black dark:hover:text-white">gridmylife</a> (sara dietschy)
        </p>
    </div>
</div>

<!-- INSTALL MODAL -->
<div id="installModal" class="modal-backdrop" onclick="if(event.target === this) toggleInstallModal()">
    <div class="modal-content text-center">
        <div class="mb-4 flex justify-center">
            <i data-lucide="smartphone" class="w-10 h-10 text-[#1d1d1f] dark:text-white"></i>
        </div>
        <h3 class="text-lg font-bold mb-2 text-[#1d1d1f] dark:text-white">Install as App</h3>
        <p class="text-sm text-gray-500 mb-6 leading-relaxed" id="installInstructions">
            Add to home screen for the best experience.
        </p>
        <button onclick="toggleInstallModal()" class="w-full py-3 rounded-lg bg-[#1d1d1f] dark:bg-white text-white dark:text-black font-bold text-sm">Got it</button>
    </div>
</div>

<script>
    // --- CONFIG ---
    const STORAGE_KEY = 'consistency_data_v4';
    const year = new Date().getFullYear();
    const lifeYears = 75;

    const quotes = [
        { "year": 1, "quote": "It is not that we have a short time to live, but that we waste a lot of it.", "author": "Seneca" },
        { "year": 2, "quote": "Time is a created thing. To say 'I don't have time,' is like saying, 'I don't want to.'", "author": "Lao Tzu" },
        { "year": 3, "quote": "How we spend our days is, of course, how we spend our lives.", "author": "Annie Dillard" },
        { "year": 4, "quote": "Tell me, what is it you plan to do with your one wild and precious life?", "author": "Mary Oliver" },
        { "year": 5, "quote": "A man who dares to waste one hour of time has not discovered the value of life.", "author": "Charles Darwin" },
        { "year": 6, "quote": "To live is the rarest thing in the world. Most people exist, that is all.", "author": "Oscar Wilde" },
        { "year": 7, "quote": "No man ever steps in the same river twice, for it's not the same river and he's not the same man.", "author": "Heraclitus" },
        { "year": 8, "quote": "You could leave life right now. Let that determine what you do and say and think.", "author": "Marcus Aurelius" },
        { "year": 9, "quote": "Life can only be understood backwards; but it must be lived forwards.", "author": "Søren Kierkegaard" },
        { "year": 10, "quote": "We are what we pretend to be, so we must be careful about what we pretend to be.", "author": "Kurt Vonnegut" },
        { "year": 11, "quote": "I saw my life branching out before me like the green fig tree in the story...", "author": "Sylvia Plath" },
        { "year": 12, "quote": "Beware; for I am fearless, and therefore powerful.", "author": "Mary Shelley" },
        { "year": 13, "quote": "It is a terrible thing to be small and weak, and the world is very big and very strong.", "author": "John Steinbeck" },
        { "year": 14, "quote": "The surest way to corrupt a youth is to instruct him to hold in higher esteem those who think alike than those who think differently.", "author": "Friedrich Nietzsche" },
        { "year": 15, "quote": "One pushes back the limits of the possible by going beyond them into the impossible.", "author": "Arthur C. Clarke" },
        { "year": 16, "quote": "I would always rather be happy than dignified.", "author": "Charlotte Brontë" },
        { "year": 17, "quote": "I want to taste and glory in each day, and never be afraid to experience pain.", "author": "Sylvia Plath" },
        { "year": 18, "quote": "To be yourself in a world that is constantly trying to make you something else is the greatest accomplishment.", "author": "Ralph Waldo Emerson" },
        { "year": 19, "quote": "Everything one does in life, even love, occurs in an express train racing toward death.", "author": "Jean Cocteau" },
        { "year": 20, "quote": "I was within and without, simultaneously enchanted and repelled by the inexhaustible variety of life.", "author": "F. Scott Fitzgerald" },
        { "year": 21, "quote": "Man is condemned to be free; because once thrown into the world, he is responsible for everything he does.", "author": "Jean-Paul Sartre" },
        { "year": 22, "quote": "If you are going through hell, keep going.", "author": "Winston Churchill" },
        { "year": 23, "quote": "There is no sun without shadow, and it is essential to know the night.", "author": "Albert Camus" },
        { "year": 24, "quote": "It is not the mountains ahead to climb that wear you out; it is the pebble in your shoe.", "author": "Muhammad Ali" },
        { "year": 25, "quote": "The only way to deal with an unfree world is to become so absolutely free that your very existence is an act of rebellion.", "author": "Albert Camus" },
        { "year": 26, "quote": "He who has a why to live can bear almost any how.", "author": "Friedrich Nietzsche" },
        { "year": 27, "quote": "We suffer more often in imagination than in reality.", "author": "Seneca" },
        { "year": 28, "quote": "The unexamined life is not worth living.", "author": "Socrates" },
        { "year": 29, "quote": "Until you make the unconscious conscious, it will direct your life and you will call it fate.", "author": "C.G. Jung" },
        { "year": 30, "quote": "When I let go of what I am, I become what I might be.", "author": "Lao Tzu" },
        { "year": 31, "quote": "I have measured out my life with coffee spoons.", "author": "T.S. Eliot" },
        { "year": 32, "quote": "We are all in the gutter, but some of us are looking at the stars.", "author": "Oscar Wilde" },
        { "year": 33, "quote": "Do not fear to be eccentric in opinion, for every opinion now accepted was once eccentric.", "author": "Bertrand Russell" },
        { "year": 34, "quote": "The mass of men lead lives of quiet desperation.", "author": "Henry David Thoreau" },
        { "year": 35, "quote": "The tragedy of life is not that it ends so soon, but that we wait so long to begin it.", "author": "W.M. Lewis" },
        { "year": 36, "quote": "If you want the truth to stand clear before you, never be for or against. The struggle between 'for' and 'against' is the mind's worst disease.", "author": "Seng-ts'an" },
        { "year": 37, "quote": "Real generosity toward the future lies in giving all to the present.", "author": "Albert Camus" },
        { "year": 38, "quote": "Everything that irritates us about others can lead us to an understanding of ourselves.", "author": "C.G. Jung" },
        { "year": 39, "quote": "There is a crack in everything, that's how the light gets in.", "author": "Leonard Cohen" },
        { "year": 40, "quote": "No one can construct for you the bridge upon which precisely you must cross the stream of life, no one but you yourself alone.", "author": "Friedrich Nietzsche" },
        { "year": 41, "quote": "The cost of a thing is the amount of what I will call life which is required to be exchanged for it.", "author": "Henry David Thoreau" },
        { "year": 42, "quote": "We do not see things as they are, we see them as we are.", "author": "Anaïs Nin" },
        { "year": 43, "quote": "If a man does not keep pace with his companions, perhaps it is because he hears a different drummer.", "author": "Henry David Thoreau" },
        { "year": 44, "quote": "To understand the world, one must be able to turn away from it on occasion.", "author": "Albert Camus" },
        { "year": 45, "quote": "The privilege of a lifetime is to become who you truly are.", "author": "C.G. Jung" },
        { "year": 46, "quote": "Not everything that is faced can be changed, but nothing can be changed until it is faced.", "author": "James Baldwin" },
        { "year": 47, "quote": "A ship in harbor is safe, but that is not what ships are built for.", "author": "John A. Shedd" },
        { "year": 48, "quote": "Freedom is what you do with what's been done to you.", "author": "Jean-Paul Sartre" },
        { "year": 49, "quote": "Life is a shipwreck, but we must not forget to sing in the lifeboats.", "author": "Voltaire" },
        { "year": 50, "quote": "In the midst of winter, I found there was, within me, an invincible summer.", "author": "Albert Camus" },
        { "year": 51, "quote": "Wisdom comes by disillusionment.", "author": "George Santayana" },
        { "year": 52, "quote": "You only have power over your mind—not outside events. Realize this, and you will find strength.", "author": "Marcus Aurelius" },
        { "year": 53, "quote": "It is difficult to get a man to understand something, when his salary depends on his not understanding it.", "author": "Upton Sinclair" },
        { "year": 54, "quote": "The world breaks everyone and afterward many are strong at the broken places.", "author": "Ernest Hemingway" },
        { "year": 55, "quote": "We are part of this universe; we are in this universe, but perhaps more important than both of those facts, is that the universe is in us.", "author": "Neil deGrasse Tyson" },
        { "year": 56, "quote": "Do not go gentle into that good night. Rage, rage against the dying of the light.", "author": "Dylan Thomas" },
        { "year": 57, "quote": "They say you die twice. One time when you stop breathing and a second time, a bit later on, when somebody says your name for the last time.", "author": "Banksy" },
        { "year": 58, "quote": "Man cannot possess anything as long as he fears death. But to him who does not fear it, everything belongs.", "author": "Leo Tolstoy" },
        { "year": 59, "quote": "The psychological rule says that when an inner situation is not made conscious, it happens outside as fate.", "author": "C.G. Jung" },
        { "year": 60, "quote": "All photographs are memento mori. To take a photograph is to participate in another person’s mortality.", "author": "Susan Sontag" },
        { "year": 61, "quote": "Life appears to me too short to be spent in nursing animosity or registering wrongs.", "author": "Charlotte Brontë" },
        { "year": 62, "quote": "The beauty of the world has two edges, one of laughter, one of anguish, cutting the heart asunder.", "author": "Virginia Woolf" },
        { "year": 63, "quote": "It is never too late to be what you might have been.", "author": "George Eliot" },
        { "year": 64, "quote": "I have to die. If it is now, well then I die now; if later, then now I will take my lunch, since the hour for lunch has arrived.", "author": "Epictetus" },
        { "year": 65, "quote": "For small creatures such as we the vastness is bearable only through love.", "author": "Carl Sagan" },
        { "year": 66, "quote": "Death is not the opposite of life, but a part of it.", "author": "Haruki Murakami" },
        { "year": 67, "quote": "Someone I loved once gave me a box full of darkness. It took me years to understand that this too, was a gift.", "author": "Mary Oliver" },
        { "year": 68, "quote": "We leave something of ourselves behind when we leave a place, we stay there, even though we go away.", "author": "Pascal Mercier" },
        { "year": 69, "quote": "The boundaries which divide Life from Death are at best shadowy and vague. Who shall say where the one ends, and where the other begins?", "author": "Edgar Allan Poe" },
        { "year": 70, "quote": "Everything that is beginning has a cause, but death has none.", "author": "Seneca" },
        { "year": 71, "quote": "One day I will find the right words, and they will be simple.", "author": "Jack Kerouac" },
        { "year": 72, "quote": "I don't know where I'm going from here, but I promise it won't be boring.", "author": "David Bowie" },
        { "year": 73, "quote": "To fear death, my friends, is only to think ourselves wise, without being wise.", "author": "Socrates" },
        { "year": 74, "quote": "We are such stuff as dreams are made on, and our little life is rounded with a sleep.", "author": "William Shakespeare" },
        { "year": 75, "quote": "Everything was beautiful and nothing hurt.", "author": "Kurt Vonnegut" }
    ];

    // --- AUDIO ---
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playPop() {
        if(audioCtx.state === 'suspended') audioCtx.resume();
        const o = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        o.type = 'sine';
        o.frequency.setValueAtTime(600, audioCtx.currentTime);
        o.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.1);
        g.gain.setValueAtTime(0.1, audioCtx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
        o.connect(g);
        g.connect(audioCtx.destination);
        o.start();
        o.stop(audioCtx.currentTime + 0.1);
    }

    // --- STATE ---
    let data = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {
        userName: "",
        birthMonth: 0,
        birthYear: 2000,
        currentHabit: "untitled",
        habits: { "untitled": [] } 
    };

    // --- DOM ---
    const els = {
        user: document.getElementById('userName'),
        viewHabit: document.getElementById('viewHabit'),
        viewLife: document.getElementById('viewLife'),
        modeHabit: document.getElementById('modeHabit'),
        modeLife: document.getElementById('modeLife'),
        habitGrid: document.getElementById('habitGrid'),
        monthRow: document.getElementById('monthRow'),
        habitSelect: document.getElementById('habitSelect'),
        dateDisplay: document.getElementById('dateDisplay'),
        streak: document.getElementById('currentStreak'),
        total: document.getElementById('totalDays'),
        consistency: document.getElementById('consistency'),
        btn: document.getElementById('markTodayBtn'),
        birthMonth: document.getElementById('birthMonth'),
        birthYear: document.getElementById('birthYear'),
        lifeGrid: document.getElementById('lifeGrid'),
        lifePercent: document.getElementById('lifePercent'),
        lifeQuote: document.getElementById('lifeQuote'),
        lifeAuthor: document.getElementById('lifeAuthor')
    };

    // --- CORRECT LOCAL DATE ---
    function getLocalTodayStr() {
        const d = new Date();
        const y = d.getFullYear();
        const m = String(d.getMonth() + 1).padStart(2, '0');
        const day = String(d.getDate()).padStart(2, '0');
        return `${y}-${m}-${day}`;
    }

    // --- INIT ---
    function init() {
        els.user.value = data.userName;
        populateLifeDropdowns();
        renderHabitView();
        
        els.user.addEventListener('input', (e) => { data.userName = e.target.value; save(); });
        els.habitSelect.addEventListener('change', (e) => { data.currentHabit = e.target.value; save(); renderHabitView(); });
        
        setTimeout(() => { document.getElementById('habitGridContainer').scrollLeft = 10000; }, 100);
        lucide.createIcons();
    }

    function save() { localStorage.setItem(STORAGE_KEY, JSON.stringify(data)); }

    function switchMode(mode) {
        if(mode === 'habit') {
            els.viewHabit.classList.remove('hidden');
            els.viewLife.classList.add('hidden');
            els.modeHabit.classList.add('active');
            els.modeLife.classList.remove('active');
            renderHabitView();
        } else {
            els.viewHabit.classList.add('hidden');
            els.viewLife.classList.remove('hidden');
            els.modeHabit.classList.remove('active');
            els.modeLife.classList.add('active');
            renderLifeGrid();
        }
    }

    // --- PWA ---
    function toggleInstallModal() {
        const modal = document.getElementById('installModal');
        const text = document.getElementById('installInstructions');
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        
        if (modal.style.display === 'flex') {
            modal.style.display = 'none';
        } else {
            text.innerHTML = isIOS ? 
                `Tap <i data-lucide="share" class="inline w-4 h-4"></i> <strong>Share</strong>, then <strong>Add to Home Screen</strong>.` : 
                `Tap the browser menu (⋮), then <strong>Install App</strong>.`;
            modal.style.display = 'flex';
            lucide.createIcons();
        }
    }

    // --- HABIT GRID ---
    function toggleDate(dateStr) {
        playPop();
        const habit = data.currentHabit;
        const index = data.habits[habit].indexOf(dateStr);
        if (index > -1) data.habits[habit].splice(index, 1);
        else data.habits[habit].push(dateStr);
        save();
        renderGrid(); updateStats();
    }

    function toggleToday() { toggleDate(getLocalTodayStr()); }
    function renderHabitView() { populateDropdown(); renderGrid(); updateStats(); }

    function renderGrid() {
        els.habitGrid.innerHTML = '';
        els.monthRow.innerHTML = '';
        
        const habit = data.habits[data.currentHabit] || [];
        const today = getLocalTodayStr();
        const startDate = new Date(year, 0, 1);
        const totalDays = 365 + (year % 4 === 0 ? 1 : 0);
        
        const frag = document.createDocumentFragment();
        
        let currentColumn = 0;
        let lastMonth = -1;
        const startDay = startDate.getDay() === 0 ? 6 : startDate.getDay() - 1;
        
        for(let i=0; i<startDay; i++) {
            const blank = document.createElement('div');
            frag.appendChild(blank);
        }

        for (let i = 0; i < totalDays; i++) {
            const d = new Date(year, 0, 1 + i);
            const y = d.getFullYear();
            const m = String(d.getMonth() + 1).padStart(2, '0');
            const day = String(d.getDate()).padStart(2, '0');
            const dateStr = `${y}-${m}-${day}`;

            const isActive = habit.includes(dateStr);
            const isToday = dateStr === today;
            
            if ((i + startDay) % 7 === 0) { 
                 const mon = d.getMonth();
                 if (mon !== lastMonth) {
                     const label = document.createElement('div');
                     label.className = 'month-label';
                     label.textContent = d.toLocaleString('default', { month: 'short' });
                     label.style.left = `${(currentColumn * 17)}px`; 
                     els.monthRow.appendChild(label);
                     lastMonth = mon;
                 }
                 currentColumn++;
            }

            const cell = document.createElement('div');
            cell.className = `day-cell ${isActive ? 'active' : ''} ${isToday ? 'today' : ''}`;
            cell.onmouseenter = () => els.dateDisplay.textContent = d.toLocaleDateString('en-IN', { weekday:'short', day:'numeric', month:'short' });
            cell.onclick = () => toggleDate(dateStr);
            frag.appendChild(cell);
        }
        els.habitGrid.appendChild(frag);
        
        const isTodayDone = habit.includes(today);
        if(isTodayDone) {
            els.btn.classList.add('active');
            els.btn.innerHTML = `<i data-lucide="check" class="w-4 h-4"></i> Completed`;
        } else {
            els.btn.classList.remove('active');
            els.btn.innerHTML = `<i data-lucide="circle" class="w-4 h-4"></i> Mark Today`;
        }
        lucide.createIcons();
    }

    function updateStats() {
        const dates = data.habits[data.currentHabit] || [];
        els.total.textContent = dates.length;

        const dayOfYear = Math.floor((new Date() - new Date(year, 0, 0)) / 86400000);
        const pct = dayOfYear > 0 ? Math.round((dates.length / dayOfYear) * 100) : 0;
        els.consistency.textContent = `${pct}%`;

        let streak = 0;
        let d = new Date(); 
        const todayStr = getLocalTodayStr();
        if (!dates.includes(todayStr)) d.setDate(d.getDate() - 1);
        
        while(true) {
             const y = d.getFullYear();
             const m = String(d.getMonth() + 1).padStart(2, '0');
             const day = String(d.getDate()).padStart(2, '0');
             const str = `${y}-${m}-${day}`;
             
             if(dates.includes(str)) {
                 streak++; d.setDate(d.getDate() - 1);
             } else break;
        }
        els.streak.textContent = streak;
    }

    // --- LIFE GRID (YEAR BLOCKS) ---
    function populateLifeDropdowns() {
        els.birthMonth.value = data.birthMonth || 0;
        const currentY = new Date().getFullYear();
        els.birthYear.innerHTML = '';
        for(let y = currentY; y >= 1950; y--) {
            const opt = document.createElement('option');
            opt.value = y; opt.text = y;
            els.birthYear.appendChild(opt);
        }
        els.birthYear.value = data.birthYear || 2000;
    }

    function animateValue(obj, start, end, duration) {
        let startTimestamp = null;
        const step = (timestamp) => {
            if (!startTimestamp) startTimestamp = timestamp;
            const progress = Math.min((timestamp - startTimestamp) / duration, 1);
            obj.innerHTML = (progress * (end - start) + start).toFixed(1) + "%";
            if (progress < 1) {
                window.requestAnimationFrame(step);
            }
        };
        window.requestAnimationFrame(step);
    }

    function renderLifeGrid() {
        data.birthMonth = els.birthMonth.value;
        data.birthYear = els.birthYear.value;
        save();

        const birth = new Date(data.birthYear, data.birthMonth, 1);
        const now = new Date();
        
        // Current Status
        const yearsLived = now.getFullYear() - birth.getFullYear();
        
        // Percent Calculation (Kept exact for the text counter)
        const totalMonths = lifeYears * 12;
        const livedMonths = (yearsLived * 12) + (now.getMonth() - birth.getMonth());
        const livedPercent = Math.min(100, (livedMonths / totalMonths) * 100);
        animateValue(els.lifePercent, 0, livedPercent, 1000);

        // Grid Render
        els.lifeGrid.innerHTML = '';
        const frag = document.createDocumentFragment();
        
        for(let i=0; i<lifeYears; i++) {
            const box = document.createElement('div');
            
            if (i < yearsLived) {
                // Past Years
                box.className = 'year-box spent';
            } else if (i === yearsLived) {
                // Current Year (Solid Active)
                box.className = 'year-box current';
            } else {
                // Future
                box.className = 'year-box';
            }
            frag.appendChild(box);
        }
        els.lifeGrid.appendChild(frag);

        // Quote
        let selectedQuote = quotes[quotes.length-1];
        for(let q of quotes) {
            if (yearsLived <= q.year) { selectedQuote = q; break; }
        }
        els.lifeQuote.textContent = `"${selectedQuote.quote}"`;
        els.lifeAuthor.textContent = selectedQuote.author;
    }

    // --- HELPERS ---
    function toggleInstallModal() {
        const modal = document.getElementById('installModal');
        const text = document.getElementById('installInstructions');
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        
        if (modal.style.display === 'flex') {
            modal.style.display = 'none';
        } else {
            text.innerHTML = isIOS ? 
                `Tap <i data-lucide="share" class="inline w-4 h-4"></i> <strong>Share</strong>, then <strong>Add to Home Screen</strong>.` : 
                `Tap the browser menu (⋮), then <strong>Install App</strong>.`;
            modal.style.display = 'flex';
            lucide.createIcons();
        }
    }

    function populateDropdown() {
        els.habitSelect.innerHTML = '';
        Object.keys(data.habits).forEach(h => {
            const opt = document.createElement('option');
            opt.value = h; opt.text = h;
            els.habitSelect.appendChild(opt);
        });
        els.habitSelect.value = data.currentHabit;
    }

    function addNewHabit() {
        const name = prompt("habit name:");
        if (name && !data.habits[name]) {
            data.habits[name] = []; data.currentHabit = name;
            save(); renderHabitView();
        }
    }

    function renameHabit() {
        const oldName = data.currentHabit;
        const newName = prompt("rename habit:", oldName);
        if (newName && newName !== oldName) {
            if (data.habits[newName]) { alert("habit already exists"); return; }
            data.habits[newName] = data.habits[oldName];
            delete data.habits[oldName];
            data.currentHabit = newName;
            save(); populateDropdown();
        }
    }

    function deleteHabit() {
        if(Object.keys(data.habits).length <= 1) return alert("cannot delete last habit. rename it instead.");
        if (confirm(`delete ${data.currentHabit}?`)) {
            delete data.habits[data.currentHabit];
            data.currentHabit = Object.keys(data.habits)[0];
            save(); renderHabitView();
        }
    }

    function exportData() {
        const name = (data.userName || "user").replace(/[^a-z0-9]/gi, '_').toLowerCase();
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(data));
        const link = document.createElement("a");
        link.setAttribute("href", dataStr);
        link.setAttribute("download", `${name}_consistency.json`);
        document.body.appendChild(link); link.click(); link.remove();
    }

    function importData(input) {
        const file = input.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const imported = JSON.parse(e.target.result);
                if (imported.habits) { data = imported; save(); init(); alert("restored."); }
            } catch (err) { alert("invalid file."); }
        };
        reader.readAsText(file);
    }

    // Start
    init();
</script>
  </main>

  <footer class="py-8 text-center text-xs text-[#86868b] opacity-60 font-mono">
    © 2025 Harsh Nahar
  </footer>

  <script>
    lucide.createIcons();
    function toggleTheme() {
      document.documentElement.classList.toggle('dark');
      localStorage.theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
    }
    if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
  </script>
</body>

</html>


